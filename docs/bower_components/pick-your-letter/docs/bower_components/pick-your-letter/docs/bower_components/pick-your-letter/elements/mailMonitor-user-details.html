<dom-module id="mailMonitor-user-details">
  <template>
    <style>
      :host {
        display: block;
        padding:20px;
      }

      paper-radio-group {
        float:left;
        border: dotted white 1px;
      }

      div.align {
        float: left;
        width: 100%;
        display: block 5px;
      }

      /*div.center{
        border:solid blue 1px;
        width: 100%;
        display: inline-block;
      }

      div.center > div { box-sizing: border-box;
        border: solid red 2px;
        margin-left: 50px;
        margin-right: auto;
        /*position: absolute;*/
        /*width: 150px;
        display: inline-block;
      }*/

    </style>
    <style is="custom-style">
      :root {
        --paper-input-container-color: white;
        --paper-input-container-focus-color: white;
        --paper-input-container-input-color: white;

        --paper-radio-button-unchecked-background-color: gray;
        --paper-radio-button-unchecked-color: white;
        --paper-radio-button-label-color: white;
        }

        paper-button.custom {
          color: white;
          clear:both;
          float:left;
          border: solid white 1px;
          margin: 0px;
          margin-top: 10px;
        }
        span.validationError {
          float:left;
          color: red;
        }
    </style>
    <iron-ajax auto
          url="{{url}}"
          handle-as="json"
          params='{"size":"500"}'
          last-response="{{handleResponse}}"></iron-ajax>

    <form is="iron-form" id="form" method="post" action="/edit">
          <paper-dropdown-menu>
              <paper-menu class="dropdown-content" attr-for-selected="value" selected="{{selection}}">
                      <template is="dom-repeat" items="{{handleResponse}}">
                        <paper-item value={{item.loginName}}>
                          <!-- <a href="{{item.preferredName}}">{{item.preferredName}}</a> -->
                          {{item.preferredName}}
                        </paper-item>
                      </template>
              </paper-menu>
          </paper-dropdown-menu>
          <paper-input label="Email" id="email" value="[[selection]]@thoughtworks.com"></paper-input>
    </form>
    <!-- <paper-input label="Name" value="{{name}}"></paper-input>
    <span class="validationError">[[validationError]]</span> -->
    <div class="align">
      <paper-radio-group selected="{{type}}">
        <paper-radio-button name="mail"><iron-icon icon="myicons:email"></iron-icon>Letter</paper-radio-button>
        <paper-radio-button name="magazine"><iron-icon icon="myicons:magazine"></iron-icon>Magazine</paper-radio-button>
        <paper-radio-button name="parcel"><iron-icon icon="myicons:parcel"></iron-icon>Parcel</paper-radio-button>
      </paper-radio-group>

      <template is="dom-if" if="{{_isParcel(type)}}" restamp="true">
        <paper-radio-group selected="{{size}}">
          <paper-radio-button name="small"><iron-icon icon="myicons:phone-small"></iron-icon>Small</paper-radio-button>
          <paper-radio-button name="medium"><iron-icon icon="myicons:tablet-medium"></iron-icon>Medium</paper-radio-button>
          <paper-radio-button name="large"><iron-icon icon="myicons:computer-big"></iron-icon>Large</paper-radio-button>
        </paper-radio-group>
      </template>
    </div>
      <paper-button raised on-tap="_send" class="custom"><iron-icon icon="myicons:email"></iron-icon>Send</paper-button>
  </template>

  <script>
    (function(Polymer) {
      Polymer({
        is: 'mailMonitor-user-details',
        properties: {
          name: {
            type:String,
            notify:true,
            value: ''
          },
          email: {
            type: String,
            notify: true,
            value: ''
          },
          size: {
            type: String,
            notify: true,
            value: 'medium'
          },
          type: {
            type: String,
            notify: true,
            value: 'mail'
          },
          validationError: {
            type: String,
            notify: true,
            value: ''
          },
          office: {
            value: 'melbourne',
            notify: true
          },
          url: {
            computed: 'computeUrl(office)'
          }
        },
        observers: [
          '_debug(size)',
          '_nameChanged(name)',
          '_emailValidation(email)'
        ],

        _emailValidation: function(email) {
          console.log('EMAIL: ', email);
            var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(email);
            // this.validationError = ' stuff';
        },
        _send: function() {
          console.log('Sending email to: ' + this.email);
        },
        _isParcel: function(type) {
          return (type === 'parcel');
        },
        _nameChanged: function(name) {
          if (name !== undefined) {
            this.email = name2email(name);
          }
        },
        _debug: function(object) {
          console.log(object);
        },
        ready: function() {
          console.log('Element mailMonitor-user-details has been created.');
        },
        computeUrl: function(office){
          // return ['https://jigsaw.thoughtworks.net/api/people?staffing_office=', office].join('/');
          return ['./aus_',office,'_consultants.json'].join('');
        },
      });

      function name2email(name) {
        if (name.trim().length == 0) { return '';
        } else {
          var parts = name.replace(' +',' ').split(' ');
          var email = parts[0];
          if (parts.length > 1 && parts[1].length > 0) {
            email += '.' + parts[parts.length - 1].trim();
          } else if (parts[0].trim().length > 0){
            email = email + '@thoughtworks.com';
          }
        } return email;
      }

    })(window.Polymer);
  </script>
</dom-module>
